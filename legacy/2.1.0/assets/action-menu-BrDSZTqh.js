import{r as p,a as c}from"./lit-element-DhY7bShc.js";import{x as u}from"./lit-html-B2eaWknC.js";import{n}from"./property-DnLABHHV.js";import{r as _}from"./reset.style-B0CQ8619.js";import{b as d}from"./property-types-CkH-zh1n.js";import{e as m}from"./class-map-BDeD7Kfm.js";import{c as f}from"./popper-CMBiYTiD.js";const b=":host{display:block;width:-moz-max-content;width:max-content;opacity:0;visibility:hidden;z-index:999}:host(.visible){opacity:1;visibility:visible}.dss-action-menu{border-radius:var(--dss-radius-sm);box-shadow:0 1px 3px #0000001a,0 4px 8px 3px #0000000d;min-width:160px;width:-moz-max-content;width:max-content;max-width:280px;background-color:var(--color-white)}.dss-action-menu--full-width{width:100%}",v=r=>u`
  <ul
    class=${m({"dss-action-menu":!0,"dss-action-menu--full-width":!!r._fullWidth})}
    aria-label="Menu d'accions"
    role="menu"
  >
    <slot></slot>
  </ul>
`;var w=Object.defineProperty,C=Object.getOwnPropertyDescriptor,l=(r,e,t,s)=>{for(var i=s>1?void 0:s?C(e,t):e,o=r.length-1,h;o>=0;o--)(h=r[o])&&(i=(s?h(e,t,i):h(i))||i);return s&&i&&w(e,t,i),i};class a extends p{constructor(){super(),this.visibleObserver=new IntersectionObserver(([e])=>{e.isIntersecting||(this.classList.remove("visible"),this._isVisible=!1,this._removeDropdownListener())},{root:null,threshold:0}),this.disablePopper=!1,this.disableParentClick=!1,this.open=!1,this.dropdownFixed=!1,this._fullWidth=!1,this._popperInstance=null,this._parent=null,this._position="right-start",this._isVisible=!1,this._disableClickOutside=!0,this._handleOutsideClick=this._handleOutsideClick.bind(this),this._handleFocusOut=this._handleFocusOut.bind(this)}static get styles(){return[c(_),c(b)]}connectedCallback(){super.connectedCallback(),this.addEventListener("onClose",this._handleCloseAllMenus)}disconnectedCallback(){this._removeDropdownListener(),this.removeEventListener("onClose",this._handleCloseAllMenus),this.visibleObserver.disconnect(),this._popperInstance&&(this._popperInstance.destroy(),this._popperInstance=null)}_addDropdownListener(){document.addEventListener("click",this._handleOutsideClick),this.addEventListener("focusout",this._handleFocusOut)}_removeDropdownListener(){document.removeEventListener("click",this._handleOutsideClick),this.removeEventListener("focusout",this._handleFocusOut)}_handleOutsideClick(e){this._checkClickOutside(e)}_handleFocusOut(e){this._checkFocusOut(e)}set fullWidth(e){const t=this._fullWidth;this._fullWidth=e,this.requestUpdate("fullWidth",t)}get fullWidth(){return this._fullWidth}set position(e){const t=this._position;this._position=e,this.requestUpdate("fullWidth",t)}get position(){return this._position}createPopperInstance(e){this._popperInstance=f(e,this,{placement:this._position,strategy:this.dropdownFixed?"fixed":"absolute",modifiers:[{name:"flip",enabled:!0,options:{boundary:"viewport",rootBoundary:"viewport"}},{name:"preventOverflow",enabled:!0,options:{boundary:"viewport"}},{name:"offset",options:{offset:[0,8]}}]}),this.visibleObserver.observe(e),e.addEventListener("click",()=>this._openByParent()),e.addEventListener("keydown",t=>{const s=t.key;(s==="Enter"||s==="Space")&&this._openByParent()})}_openByParent(){!this._isVisible&&!this.disableParentClick&&(this._popperInstance.update(),this.classList.add("visible"),this._disableClickOutside=!1,this._isVisible=!0,this._addDropdownListener())}_handleCloseAllMenus(){this._closeMenu()}_handleSlotChange(){var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector("slot");if(e){const s=e.assignedElements({flatten:!0}).filter(i=>i.tagName.toLowerCase()==="dss-action-menu-item");s.forEach((i,o)=>{o===0?i.setAttribute("first",""):i.removeAttribute("first"),o===s.length-1?i.setAttribute("last",""):i.removeAttribute("last")})}}_checkClickOutside(e){if(this.disableParentClick&&this._disableClickOutside)return;const t=e.composedPath(),s=t.includes(this._parent);!t.some(o=>o instanceof HTMLElement&&(o.tagName.toLowerCase()==="dss-action-menu"||o.tagName.toLowerCase()==="ul"&&o.classList.contains("dss-action-menu")))&&!s&&!this.disablePopper&&this._closeMenu()}_checkFocusOut(e){const t=e.relatedTarget;t!==null&&t!==this&&t.tagName.toLowerCase()!=="dss-action-menu-item"&&this._closeMenu()}_closeMenu(){setTimeout(()=>{this.classList.contains("visible")&&(this.classList.remove("visible"),this._isVisible=!1,this.dispatchEvent(new CustomEvent("onCloseActionMenu")),this._removeDropdownListener())},0)}async firstUpdated(){var s;await this.updateComplete;const e=this.assignedSlot;this._parent=e?e.parentElement:this.parentElement,this._parent&&!this.disablePopper&&this.createPopperInstance(this._parent),this.disablePopper&&(this.classList.add("visible"),this._addDropdownListener());const t=(s=this.shadowRoot)==null?void 0:s.querySelector("slot");t&&t.addEventListener("slotchange",()=>this._handleSlotChange()),this._handleSlotChange()}updated(e){super.updated(e),e.has("position")&&this._popperInstance&&this._popperInstance.setOptions({placement:this.position}),e.has("open")&&(this.open?(this.classList.add("visible"),this._popperInstance.update(),setTimeout(()=>{this._addDropdownListener(),this._disableClickOutside=!1},100)):(this.classList.remove("visible"),this._disableClickOutside=!0,this._removeDropdownListener()))}render(){return v(this)}}l([n(d)],a.prototype,"fullWidth",1);l([n({type:String})],a.prototype,"position",1);l([n(d)],a.prototype,"disablePopper",2);l([n(d)],a.prototype,"disableParentClick",2);l([n(d)],a.prototype,"open",2);l([n(d)],a.prototype,"dropdownFixed",2);export{a as A};
