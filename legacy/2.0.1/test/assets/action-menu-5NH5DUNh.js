import{r as d,a as c}from"./lit-element-DhY7bShc.js";import{x as u}from"./lit-html-B2eaWknC.js";import{n as l}from"./property-DnLABHHV.js";import{r as m}from"./reset.style-B0CQ8619.js";import{b as p}from"./property-types-CkH-zh1n.js";import{e as f}from"./class-map-BDeD7Kfm.js";import{c as _}from"./popper-CMBiYTiD.js";const b=":host{display:block;width:-moz-max-content;width:max-content;opacity:0;visibility:hidden;z-index:999}:host(.visible){opacity:1;visibility:visible}.dss-action-menu{border-radius:var(--dss-radius-sm);box-shadow:0 1px 3px #0000001a,0 4px 8px 3px #0000000d;min-width:160px;width:-moz-max-content;width:max-content;max-width:280px;background-color:var(--color-white)}.dss-action-menu--full-width{width:100%}",v=n=>u`
  <ul
    class=${f({"dss-action-menu":!0,"dss-action-menu--full-width":!!n._fullWidth})}
    aria-label="Menu d'accions"
    role="menu"
  >
    <slot></slot>
  </ul>
`;var w=Object.defineProperty,C=Object.getOwnPropertyDescriptor,a=(n,t,e,i)=>{for(var s=i>1?void 0:i?C(t,e):t,o=n.length-1,h;o>=0;o--)(h=n[o])&&(s=(i?h(t,e,s):h(s))||s);return i&&s&&w(t,e,s),s};class r extends d{constructor(){super(...arguments),this.disablePopper=!1,this.disableParentClick=!1,this.open=!1,this._fullWidth=!1,this._popperInstance=null,this._parent=null,this._position="right-start",this._isVisible=!1}static get styles(){return[c(m),c(b)]}connectedCallback(){super.connectedCallback(),this.addEventListener("onClose",this._handleCloseAllMenus)}disconnectedCallback(){this.removeEventListener("onClose",this._handleCloseAllMenus),this._popperInstance&&(this._popperInstance.destroy(),this._popperInstance=null)}set fullWidth(t){const e=this._fullWidth;this._fullWidth=t,this.requestUpdate("fullWidth",e)}get fullWidth(){return this._fullWidth}set position(t){const e=this._position;this._position=t,this.requestUpdate("fullWidth",e)}get position(){return this._position}createPopperInstance(t){this._popperInstance=_(t,this,{placement:this._position,modifiers:[{name:"flip",enabled:!0,options:{boundary:"viewport",rootBoundary:"viewport"}},{name:"preventOverflow",enabled:!0,options:{boundary:"viewport"}},{name:"offset",options:{offset:[0,8]}}]}),t.addEventListener("click",()=>{!this._isVisible&&!this.disableParentClick&&(this._popperInstance.update(),this.classList.add("visible"),this._isVisible=!0)})}_handleCloseAllMenus(){this._closeMenu()}_handleSlotChange(){var e;const t=(e=this.shadowRoot)==null?void 0:e.querySelector("slot");if(t){const i=t.assignedElements({flatten:!0}).filter(s=>s.tagName.toLowerCase()==="dss-action-menu-item");i.forEach((s,o)=>{o===0?s.setAttribute("first",""):s.removeAttribute("first"),o===i.length-1?s.setAttribute("last",""):s.removeAttribute("last")})}}_clickOutside(){document.addEventListener("click",t=>{const e=t.composedPath(),i=e.includes(this._parent);!e.some(o=>o instanceof HTMLElement&&(o.tagName.toLowerCase()==="dss-action-menu"||o.tagName.toLowerCase()==="ul"&&o.classList.contains("dss-action-menu")))&&!i&&!this.disablePopper&&this._closeMenu()})}_closeMenu(){setTimeout(()=>{this.classList.contains("visible")&&(this.classList.remove("visible"),this._isVisible=!1,this.dispatchEvent(new CustomEvent("onCloseActionMenu")))},0)}async firstUpdated(){var i;await this.updateComplete;const t=this.assignedSlot;this._parent=t?t.parentElement:this.parentElement,this._parent&&!this.disablePopper&&this.createPopperInstance(this._parent),this.disablePopper&&this.classList.add("visible");const e=(i=this.shadowRoot)==null?void 0:i.querySelector("slot");e&&e.addEventListener("slotchange",()=>this._handleSlotChange()),this._handleSlotChange(),setTimeout(()=>{this._clickOutside()},0)}updated(t){super.updated(t),t.has("position")&&this._popperInstance&&this._popperInstance.setOptions({placement:this.position}),t.has("open")&&(this.open?this.classList.add("visible"):this.classList.remove("visible"))}render(){return v(this)}}a([l(p)],r.prototype,"fullWidth",1);a([l({type:String})],r.prototype,"position",1);a([l(p)],r.prototype,"disablePopper",2);a([l(p)],r.prototype,"disableParentClick",2);a([l(p)],r.prototype,"open",2);export{r as A};
