import{r as _,a as u}from"./lit-element-DhY7bShc.js";import{x as f}from"./lit-html-B2eaWknC.js";import{n as o}from"./property-DnLABHHV.js";import{r as m}from"./reset.style-B0CQ8619.js";import{b as h}from"./property-types-CkH-zh1n.js";import{e as b}from"./class-map-BDeD7Kfm.js";import{c as v}from"./popper-CMBiYTiD.js";const C=":host{display:block;width:-moz-max-content;width:max-content;opacity:0;visibility:hidden;z-index:999}:host(.visible){opacity:1;visibility:visible}.dss-action-menu{border-radius:var(--dss-radius-sm);box-shadow:0 1px 3px #0000001a,0 4px 8px 3px #0000000d;min-width:160px;width:-moz-max-content;width:max-content;max-width:280px;background-color:var(--color-white)}.dss-action-menu--full-width{width:100%}",w=r=>f`
  <ul
    class=${b({"dss-action-menu":!0,"dss-action-menu--full-width":!!r._fullWidth})}
    aria-label="Menu d'accions"
    role="menu"
  >
    <slot></slot>
  </ul>
`;var y=Object.defineProperty,L=Object.getOwnPropertyDescriptor,l=(r,t,e,s)=>{for(var i=s>1?void 0:s?L(t,e):t,n=r.length-1,d;n>=0;n--)(d=r[n])&&(i=(s?d(t,e,i):d(i))||i);return s&&i&&y(t,e,i),i};class a extends _{constructor(){super(),this.visibleObserver=new IntersectionObserver(([t])=>{t.isIntersecting||(this.classList.remove("visible"),this._isVisible=!1,this._removeDropdownListener())},{root:null,threshold:0}),this.disablePopper=!1,this.disableParentClick=!1,this.open=!1,this.dropdownFixed=!1,this._fullWidth=!1,this._popperInstance=null,this._parent=null,this._position="right-start",this._isVisible=!1,this._disableClickOutside=!0,this._isFirstUpdate=!0,this._handleOutsideClick=this._handleOutsideClick.bind(this),this._handleFocusOut=this._handleFocusOut.bind(this)}static get styles(){return[u(m),u(C)]}connectedCallback(){super.connectedCallback(),this.addEventListener("onClose",this._handleCloseAllMenus),this._handleConnectedCallback()}disconnectedCallback(){this._removeDropdownListener(),this.removeEventListener("onClose",this._handleCloseAllMenus),this.visibleObserver.disconnect(),this._popperInstance&&(this._popperInstance.destroy(),this._popperInstance=null)}_addDropdownListener(){document.addEventListener("click",this._handleOutsideClick),this.addEventListener("focusout",this._handleFocusOut)}_removeDropdownListener(){document.removeEventListener("click",this._handleOutsideClick),this.removeEventListener("focusout",this._handleFocusOut)}_handleOutsideClick(t){this._checkClickOutside(t)}_handleFocusOut(t){this._checkFocusOut(t)}_handleConnectedCallback(){if(this._isFirstUpdate)return;const t=this.style.position;t!=="absolute"&&t!=="fixed"&&t!=="relative"&&(this._popperInstance?this._popperInstance.update():this._initActionMenu())}set fullWidth(t){const e=this._fullWidth;this._fullWidth=t,this.requestUpdate("fullWidth",e)}get fullWidth(){return this._fullWidth}set position(t){const e=this._position;this._position=t,this.requestUpdate("fullWidth",e)}get position(){return this._position}createPopperInstance(t){this._popperInstance=v(t,this,{placement:this._position,strategy:this.dropdownFixed?"fixed":"absolute",modifiers:[{name:"flip",enabled:!0,options:{boundary:"viewport",rootBoundary:"viewport"}},{name:"preventOverflow",enabled:!0,options:{boundary:"viewport"}},{name:"offset",options:{offset:[0,8]}}]}),this.visibleObserver.observe(t),t.addEventListener("click",()=>this._openByParent()),t.addEventListener("keydown",e=>{const s=e.key;(s==="Enter"||s==="Space")&&this._openByParent()})}_openByParent(){!this._isVisible&&!this.disableParentClick&&(this._popperInstance.update(),this.classList.add("visible"),this._disableClickOutside=!1,this._isVisible=!0,this._addDropdownListener())}_handleCloseAllMenus(){this._closeMenu()}_handleSlotChange(){var e;const t=(e=this.shadowRoot)==null?void 0:e.querySelector("slot");if(t){const s=t.assignedElements({flatten:!0}).filter(i=>i.tagName.toLowerCase()==="dss-action-menu-item");s.forEach((i,n)=>{n===0?i.setAttribute("first",""):i.removeAttribute("first"),n===s.length-1?i.setAttribute("last",""):i.removeAttribute("last")})}}_checkClickOutside(t){var c;if(this.disableParentClick&&this._disableClickOutside)return;const e=t.composedPath(),s=e.includes(this._parent);if(!e.some(p=>p instanceof HTMLElement&&(p.tagName.toLowerCase()==="dss-action-menu"||p.tagName.toLowerCase()==="ul"&&p.classList.contains("dss-action-menu")))&&!s&&!this.disablePopper)return this._closeMenu();const n=this._parent.classList.contains("dss-split-button-action"),d=(c=this._parent)==null?void 0:c.getAttribute("data-expanded");if(n&&d==="false")return this._closeMenu()}_checkFocusOut(t){const e=t.relatedTarget;e!==null&&e!==this&&e.tagName.toLowerCase()!=="dss-action-menu-item"&&this._closeMenu()}_closeMenu(){setTimeout(()=>{this.classList.contains("visible")&&(this.classList.remove("visible"),this._isVisible=!1,this.dispatchEvent(new CustomEvent("onCloseActionMenu")),this._removeDropdownListener())},0)}_initActionMenu(){var s;const t=this.assignedSlot;this._parent=t?t.parentElement:this.parentElement,this._parent&&!this.disablePopper&&this.createPopperInstance(this._parent),this.disablePopper&&(this.classList.add("visible"),this._addDropdownListener());const e=(s=this.shadowRoot)==null?void 0:s.querySelector("slot");e&&e.addEventListener("slotchange",()=>this._handleSlotChange()),this._handleSlotChange()}async firstUpdated(){await this.updateComplete,this._initActionMenu(),this._isFirstUpdate=!1}updated(t){super.updated(t),t.has("position")&&this._popperInstance&&this._popperInstance.setOptions({placement:this.position}),t.has("open")&&(this.open?(this.classList.add("visible"),this._isVisible=!0,this._popperInstance.update(),setTimeout(()=>{this._addDropdownListener(),this._disableClickOutside=!1},100)):(this.classList.remove("visible"),this._isVisible=!1,this._disableClickOutside=!0,this._removeDropdownListener()))}render(){return w(this)}}l([o(h)],a.prototype,"fullWidth",1);l([o({type:String})],a.prototype,"position",1);l([o(h)],a.prototype,"disablePopper",2);l([o(h)],a.prototype,"disableParentClick",2);l([o(h)],a.prototype,"open",2);l([o(h)],a.prototype,"dropdownFixed",2);export{a as A};
